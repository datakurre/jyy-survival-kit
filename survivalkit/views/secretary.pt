<?xml version="1.0" encoding="utf-8"?>
<metal:page metal:use-macro="sitemacros/macros/master">
  <metal:meta metal:fill-slot="meta" tal:condition="download">
    <meta http-equiv="refresh" tal:attributes="content string:0;;url=${root}Collection/${download}/download" />
  </metal:meta>
  <metal:main metal:fill-slot="main">
    <div id="secretary">
      <div class="header">
        <h1 tal:content="title" />
        <p>All Your Kits Are Belong to Us :-)</p>
        <p><strong>See also:</strong> <a href="http://survival-kit.appspot.com/">survival-kit.appspot.com</a>.</p>
      </div>
      <div class="content">
        <h2>Download Waiting Orders</h2>
        <form tal:condition="orders/count"
              tal:attributes="action string:${root}Collection/create"
              tal:define="order_count python:orders.count();
                          global kit_count python:0"
              method="post">
          <tal:repeat repeat="order orders">
          <input type="hidden" name="order"
                 tal:attributes="value order/key"
                 tal:define="global kit_count python:kit_count+order.kit_set.count()" />
           </tal:repeat>
          <p>There <span tal:omit-tag="" tal:condition="python:order_count==1">is a</span><span tal:omit-tag="" tal:condition="python:order_count>1">are</span> waiting order<span tal:omit-tag="" tal:condition="python:order_count>1">s</span> for <span tal:omit-tag="" tal:content="kit_count" /> kit<span tal:omit-tag="" tal:condition="python:kit_count>1">s</span>.
            <input type="submit" value="Download orders" />
          </p>
        </form>
        <p tal:condition="not:orders/count">
          There are no waiting orders.
        </p>
        <tal:condition condition="collections/count">
          <h2>Manage Old Downloads</h2>
          <ul>
            <li tal:repeat="collection collections">
              Order<span tal:omit-tag="" tal:condition="python:collection.order_set.count() > 1">s</span> for <span tal:omit-tag="" tal:content="collection/kit_count">19</span> kit<span tal:omit-tag="" tal:condition="python:collection.kit_count > 1">s</span> downloaded on
              <a tal:attributes="href string:${root}Collection/${collection/key}/download"
                 tal:content="python:collection.created.strftime('.%d.%m.%Y').replace('.0','.')[1:]" />
              <span tal:omit-tag="" tal:content="python:collection.created.strftime('at %H:%M')" />
              <a tal:attributes="href string:${root}Collection/${collection/key}/delete">
                remove
              </a>
            </li>
          </ul>
        </tal:condition>
        <h2>Manage Survival Kit Order Form</h2>
        <h3>Available Pick-Up Dates</h3>
        <form tal:attributes="action string:${root}ReleaseDate/create"
              method="post">
          <ul>
            <li tal:repeat="release_date release_dates">
              <span tal:content="release_date/date" />
              <a tal:attributes="href string:${root}ReleaseDate/${release_date/key}/delete">
                remove
              </a>
            </li>
            <li>
              <input name="date" />
              <input type="submit" value="Add a new date" /> 
            </li>
          </ul>
        </form>
        <h3>Available Exchange Durations</h3>
        <form tal:attributes="action string:${root}ExchangeType/create"
              method="post">
          <ul>
            <li tal:repeat="exchange_type exchange_types">
              <span tal:content="exchange_type/type" />
              <a tal:attributes="href string:${root}ExchangeType/${exchange_type/key}/delete">
                remove
              </a>
            </li>
            <li>
              <input name="type" />
              <input type="submit" value="Add a new duration" />
            </li>
          </ul>
        </form>
        <h3>Instructions</h3>
        <ul>
          <li tal:repeat="instruction instructions">
            <span tal:content="instruction/topic" />
            <a tal:attributes="href string:${root}Instruction/${instruction/key}/delete">
              remove
            </a>
          </li>
        </ul>
        <form tal:attributes="action string:${root}Instruction/create"
              method="post">
          <table id="instructions">
            <tr>
              <td>Topic</td>
              <td><input name="topic" size="30" /></td>
            </tr>
            <tr>
              <td>Details</td>
              <td>
                <textarea cols="30" rows="4" name="details"></textarea>
              </td>
            </tr>
            <tr>
              <td></td>
              <td><input type="submit" value="Add a new instruction" /></td>
            </tr>
          </table>
        </form>
      </div>
    </div>
  </metal:main>
</metal:page>